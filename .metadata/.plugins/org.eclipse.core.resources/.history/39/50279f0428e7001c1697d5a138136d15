package Main;

import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.Image;
import java.awt.Label;
import java.awt.Rectangle;
import java.awt.Scrollbar;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.KeyAdapter;
import java.awt.event.KeyEvent;
import java.awt.event.KeyListener;
import java.awt.image.BufferedImage;
import java.io.BufferedReader;
import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.File;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.*;

import javax.imageio.ImageIO;
import javax.swing.Box;
import javax.swing.BoxLayout;
import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JFileChooser;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JList;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JScrollBar;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;
import javax.swing.JTextField;
import javax.swing.border.Border;
import javax.swing.border.EmptyBorder;import javax.swing.event.AncestorEvent;
import javax.swing.event.AncestorListener;
import javax.swing.text.html.ListView;

public class GUI extends Thread {
	private JFrame homeForm, form1;
	private static String name = null;
	private JTextArea jtaMessage ;
	@Override
	public void run() {
		while(true)
		{
			jtaMessage.setText(jtaMessage.getText() + "\n" + MulticastReceiver.Receiver());
		}
	}
	
  public static void main(String[] args) throws Exception {
   new GUI(); 
  }

  public GUI() throws Exception {
	  Home();

  }
  
  private void Form1() {
	form1 = new JFrame("BK ZALO - " +  name);
    form1.setSize(500, 400);
    form1.setDefaultCloseOperation(3);
    form1.setLayout(new BorderLayout());
    
    JLabel pic = new JLabel();
    pic.setVisible(false);
    
    JPanel pnHeader = new JPanel();
    pnHeader.setLayout(new BoxLayout(pnHeader, BoxLayout.X_AXIS));
    
    JLabel lb = new JLabel("Nhập tin nhắn: ");
    
    JButton btnChooseImg = new JButton();
	 Image img = null;
	try {
		img = ImageIO.read(new File(".//src//imgicon.png"));
	} catch (IOException e1) {
		// TODO Auto-generated catch block
		e1.printStackTrace();
	}
	// img to small size
	img = img.getScaledInstance(30, 30, java.awt.Image.SCALE_SMOOTH);
    btnChooseImg.setIcon(new ImageIcon(img));
    btnChooseImg.addActionListener(new ActionListener() {
		
		@Override
		public void actionPerformed(ActionEvent e) {
			JFileChooser fileChooser = new JFileChooser();
            fileChooser.setCurrentDirectory(new File(System.getProperty("user.home")));
            int result = fileChooser.showOpenDialog(getParent());
            if (result == JFileChooser.APPROVE_OPTION) {
                try {
                    File file = fileChooser.getSelectedFile();
                    BufferedImage picture = ImageIO.read(file);
                }
			
		}
	});
    
    JTextField tfMessage = new JTextField();
    
    tfMessage.addKeyListener(new KeyAdapter() {
				@Override
		public void keyPressed(KeyEvent e) {
			if(e.getKeyCode() == KeyEvent.VK_ENTER)
			{
				MulticastSender.Send(name + ": " + tfMessage.getText());
				tfMessage.setText("");
			}
		}
	});

    JButton btnSend = new JButton("Gửi");
    btnSend.addActionListener(new ActionListener() {
		
		@Override
		public void actionPerformed(ActionEvent e) {
			MulticastSender.Send(name + ": " + tfMessage.getText());
			tfMessage.setText("");
		}
	});

   
    pnHeader.add(lb);
    pnHeader.add(btnChooseImg);
    pnHeader.add(tfMessage);
    pnHeader.add(btnSend);

    form1.add(pnHeader, BorderLayout.SOUTH);

    jtaMessage = new JTextArea();
    jtaMessage.setEditable(false);

    JScrollPane scrollta = new JScrollPane(jtaMessage);
    form1.add(scrollta, BorderLayout.CENTER);
    form1.setVisible(true);
    start();
    
    
}
  
  private void Home() {
	JPanel pnMain = new JPanel();
		
	JLabel lb = new JLabel("Enter yourname: ");
	lb.setBounds(0, 0, 100, 30);
	
	JTextField tfName = new JTextField();
	tfName.setBounds(110, 0, 190, 30);
	tfName.addKeyListener(new KeyAdapter() {
		@Override
        public void keyPressed(KeyEvent e) {
            if(e.getKeyCode() == KeyEvent.VK_ENTER){
            	homeForm.dispose();
    			name =  tfName.getText();
    			Form1();
            }
        }
	});
	
	JButton btnOK = new JButton("OK");
	btnOK.setBounds(310, 0, 70, 30);
	btnOK.addActionListener(new ActionListener() {
		
		@Override
		public void actionPerformed(ActionEvent e) {
			homeForm.dispose();
			name =  tfName.getText();
			Form1();
		}
	});
	
	
	
	
	
	
//	pnMain.setSize(300, 30);
	pnMain.setLayout(null);
	
	pnMain.add(lb);
	pnMain.add(tfName);
	pnMain.add(btnOK);
	
	
	homeForm = new JFrame("Home");
	homeForm.setSize(440, 120);
	homeForm.setMaximizedBounds(null);
	homeForm.getRootPane().setBorder(new EmptyBorder(20,20,20,20));
	homeForm.add(pnMain);
	homeForm.setDefaultCloseOperation(3);
	homeForm.setVisible(true);
}
}
