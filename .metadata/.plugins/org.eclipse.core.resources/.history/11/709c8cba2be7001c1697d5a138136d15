package Main;

import java.awt.*;
import java.awt.event.*;
import java.awt.image.BufferedImage;
import java.io.*;
import javax.imageio.ImageIO;
import javax.swing.*;
import javax.swing.border.EmptyBorder;

public class GUI extends Thread {

  private JFrame homeForm, form1;
  private static String name = null;
  private JTextArea jtaMessage;

  @Override
  public void run() {
    while (true) {
      jtaMessage.setText(
        jtaMessage.getText() + "\n" + MulticastReceiver.Receiver()
      );
    }
  }

  public static void main(String[] args) throws Exception {
    new GUI();
  }

  public GUI() throws Exception {
    Home();
  }

  private void Form1() {
    form1 = new JFrame("BK ZALO - " + name);
    form1.setSize(500, 400);
    form1.setDefaultCloseOperation(3);
    form1.setLayout(new BorderLayout());
    Image img = null;

    JButton btnDelImg = new JButton();
    try {
      img = ImageIO.read(new File(".//src//closeimg.png"));
    } catch (IOException e1) {
      // TODO Auto-generated catch block
      e1.printStackTrace();
    }
    // img to small size
    img = img.getScaledInstance(5, 10, java.awt.Image.SCALE_SMOOTH);
    btnDelImg.setIcon(new ImageIcon(img));
    //	btnDelImg.setBounds(0, 0, 5, 5);
    btnDelImg.setVisible(false);

    JPanel pnHeader = new JPanel();
    pnHeader.setLayout(new BoxLayout(pnHeader, BoxLayout.X_AXIS));

    JLabel lb = new JLabel("Nhập tin nhắn: ");

    JButton btnChooseImg = new JButton();
    Image imgicon = null;
    try {
      imgicon = ImageIO.read(new File(".//src//imgicon.png"));
    } catch (IOException e1) {
      // TODO Auto-generated catch block
      e1.printStackTrace();
    }
    // img to small size
    imgicon = imgicon.getScaledInstance(30, 30, java.awt.Image.SCALE_SMOOTH);
    btnChooseImg.setIcon(new ImageIcon(imgicon));

    btnDelImg.addActionListener(
      new ActionListener() {
        @Override
        public void actionPerformed(ActionEvent e) {
          btnChooseImg.setIcon(new ImageIcon(imgicon));
          btnDelImg.setVisible(false);
        }
      }
    );

    // add btndel in left corner of btnChooseImg
    btnChooseImg.addActionListener(
      new ActionListener() {
        @Override
        public void actionPerformed(ActionEvent e) {
          JFileChooser fileChooser = new JFileChooser();
          fileChooser.setCurrentDirectory(
            new File(System.getProperty("user.home"))
          );
          int result = fileChooser.showOpenDialog(form1.getParent());
          if (result == JFileChooser.APPROVE_OPTION) {
            try {
              File file = fileChooser.getSelectedFile();
              Image picture = ImageIO.read(file);
              btnDelImg.setVisible(true);
              picture =
                picture.getScaledInstance(
                  150,
                  150,
                  java.awt.Image.SCALE_SMOOTH
                );
              btnChooseImg.setIcon(new ImageIcon(picture));
              btnDelImg.setVisible(true);
            } catch (Exception e1) {
              // TODO: handle exception
            }
          }
        }
      }
    );

    JTextField tfMessage = new JTextField();

    tfMessage.addKeyListener(
      new KeyAdapter() {
        @Override
        public void keyPressed(KeyEvent e) {
          if (e.getKeyCode() == KeyEvent.VK_ENTER) {
            MulticastSender.Send(name + ": " + tfMessage.getText());
            tfMessage.setText("");
          }
        }
      }
    );

    JButton btnSend = new JButton("Gửi");
    btnSend.addActionListener(
      new ActionListener() {
        @Override
        public void actionPerformed(ActionEvent e) {
          MulticastSender.Send(name + ": " + tfMessage.getText());
          tfMessage.setText("");
        }
      }
    );

    pnHeader.add(lb);
    pnHeader.add(btnChooseImg);
    pnHeader.add(btnDelImg);
    pnHeader.add(tfMessage);
    pnHeader.add(btnSend);

    form1.add(pnHeader, BorderLayout.SOUTH);

    jtaMessage = new JTextArea();
    jtaMessage.setEditable(false);

    JScrollPane scrollta = new JScrollPane(jtaMessage);
    form1.add(scrollta, BorderLayout.CENTER);
    form1.setVisible(true);
    start();
  }

  private void Home() {
    JPanel pnMain = new JPanel();

    JLabel lb = new JLabel("Enter yourname: ");
    lb.setBounds(0, 0, 100, 30);

    JTextField tfName = new JTextField();
    tfName.setBounds(110, 0, 190, 30);
    tfName.addKeyListener(
      new KeyAdapter() {
        @Override
        public void keyPressed(KeyEvent e) {
          if (e.getKeyCode() == KeyEvent.VK_ENTER) {
            homeForm.dispose();
            name = tfName.getText();
            Form1();
          }
        }
      }
    );

    JButton btnOK = new JButton("OK");
    btnOK.setBounds(310, 0, 70, 30);
    btnOK.addActionListener(
      new ActionListener() {
        @Override
        public void actionPerformed(ActionEvent e) {
          homeForm.dispose();
          name = tfName.getText();
          Form1();
        }
      }
    );

    //	pnMain.setSize(300, 30);
    pnMain.setLayout(null);

    pnMain.add(lb);
    pnMain.add(tfName);
    pnMain.add(btnOK);

    homeForm = new JFrame("Home");
    homeForm.setSize(440, 120);
    homeForm.setMaximizedBounds(null);
    homeForm.getRootPane().setBorder(new EmptyBorder(20, 20, 20, 20));
    homeForm.add(pnMain);
    homeForm.setDefaultCloseOperation(3);
    homeForm.setVisible(true);
  }
}
